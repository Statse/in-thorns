---
import { readdirSync } from 'fs'
import { join } from 'path'
import { Image } from 'astro:assets'

// Read images from public/photos/exit_wounds directory
const photosDir = join(process.cwd(), 'public', 'photos', 'exit_wounds')
const imageFiles = readdirSync(photosDir)
	.filter((file) => file.endsWith('.webp'))
	.sort((a, b) => {
		// Extract numbers from filenames for proper numeric sorting
		const numA = parseInt(a.match(/\d+/)?.[0] || '0')
		const numB = parseInt(b.match(/\d+/)?.[0] || '0')
		return numA - numB
	})

// Color classes to cycle through
const colorClasses = ['ew-orange', 'ew-green', 'ew-red']

// Mosaic layout pattern matching the design
// tall = 2 rows, wide = 2 cols, large = 2x2
const mosaicPattern = [
	'large',  // 1: Large 2x2 (top left)
	'normal', // 2: Small 1x1 (top right)
	'tall',   // 3: Tall 1x2 (right side)
	'normal', // 4: Small 1x1
	'normal', // 5: Small 1x1
	'normal', // 6: Small 1x1 (left)
	'large',  // 7: Large 2x2 (right)
	'wide',   // 8: Wide 2x1
	'wide',   // 9: Wide 2x1
	'normal', // 10: Small 1x1
	'normal', // 11: Small 1x1
	'large',  // 12: Large 2x2
]

const photos = imageFiles.map((file, index) => ({
	id: String(index + 1),
	src: `/photos/exit_wounds/${file}`,
	alt: 'In Thorns - Exit Wounds',
	colorClass: colorClasses[index % colorClasses.length],
	layout: mosaicPattern[index % mosaicPattern.length]
}))
---

<section id='photos' class='min-h-screen bg-black py-20 px-4'>
	<div class='container mx-auto max-w-7xl'>
		<h2 class='text-4xl md:text-5xl font-bold text-ew-orange mb-16 text-center'>
			<span class='inline-block' style='text-shadow: 0 0 20px rgba(255, 107, 53, 0.5);'>Photos</span>
		</h2>

		<div class='grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 auto-rows-[200px]'>
			{
				photos.map((photo) => (
					<a
						href={`/photos/${photo.id}`}
						class:list={[
							'relative overflow-hidden group cursor-pointer',
							{
								'md:col-span-2 md:row-span-2': photo.layout === 'large',
								'md:col-span-2': photo.layout === 'wide',
								'md:row-span-2': photo.layout === 'tall'
							}
						]}
					>
						<Image
							src={photo.src}
							alt={photo.alt}
							width={800}
							height={800}
							class='w-full h-full object-cover group-hover:scale-110 transition-transform duration-500'
							transition:name={`photo-${photo.id}`}
						/>
						<div class:list={[
							'absolute inset-0 group-hover:bg-opacity-20 bg-opacity-0 transition-colors',
							`bg-${photo.colorClass}`
						]} />
					</a>
				))
			}
		</div>
	</div>
</section>
