---
import PhotoItem from './components/photo-item.astro'
import { readdirSync } from 'fs'
import { join } from 'path'

// Read images from public/photos/exit_wounds directory
const photosDir = join(process.cwd(), 'public', 'photos', 'exit_wounds')
const imageFiles = readdirSync(photosDir)
	.filter((file) => file.endsWith('.webp'))
	.sort((a, b) => {
		// Extract numbers from filenames for proper numeric sorting
		const numA = parseInt(a.match(/\d+/)?.[0] || '0')
		const numB = parseInt(b.match(/\d+/)?.[0] || '0')
		return numA - numB
	})

// Color classes to cycle through
const colorClasses = ['ew-orange', 'ew-green', 'ew-red']

// Create asymmetric layout: alternating between large groups and small groups
// Pattern: [large+2small, 3small, 2small+large, 3small, ...]
const photos: any[] = []
let photoIndex = 0
let groupType = 0 // 0: large left, 1: 3 small, 2: large right, 3: 3 small

while (photoIndex < imageFiles.length) {
	if (groupType === 0) {
		// Group 1: Large left + 2 small right (L shape)
		if (photoIndex + 2 < imageFiles.length) {
			photos.push(
				{ id: String(photoIndex + 1), src: `/photos/exit_wounds/${imageFiles[photoIndex]}`, alt: 'In Thorns - Exit Wounds', colorClass: colorClasses[photoIndex % colorClasses.length], large: true },
				{ id: String(photoIndex + 2), src: `/photos/exit_wounds/${imageFiles[photoIndex + 1]}`, alt: 'In Thorns - Exit Wounds', colorClass: colorClasses[(photoIndex + 1) % colorClasses.length], large: false },
				{ id: String(photoIndex + 3), src: `/photos/exit_wounds/${imageFiles[photoIndex + 2]}`, alt: 'In Thorns - Exit Wounds', colorClass: colorClasses[(photoIndex + 2) % colorClasses.length], large: false }
			)
			photoIndex += 3
		}
	} else if (groupType === 1) {
		// Group 2: 3 small
		for (let i = 0; i < 3 && photoIndex < imageFiles.length; i++) {
			photos.push({
				id: String(photoIndex + 1),
				src: `/photos/exit_wounds/${imageFiles[photoIndex]}`,
				alt: 'In Thorns - Exit Wounds',
				colorClass: colorClasses[photoIndex % colorClasses.length],
				large: false
			})
			photoIndex++
		}
	} else if (groupType === 2) {
		// Group 3: 2 small left + large right (reversed L)
		if (photoIndex + 2 < imageFiles.length) {
			photos.push(
				{ id: String(photoIndex + 1), src: `/photos/exit_wounds/${imageFiles[photoIndex]}`, alt: 'In Thorns - Exit Wounds', colorClass: colorClasses[photoIndex % colorClasses.length], large: false },
				{ id: String(photoIndex + 2), src: `/photos/exit_wounds/${imageFiles[photoIndex + 1]}`, alt: 'In Thorns - Exit Wounds', colorClass: colorClasses[(photoIndex + 1) % colorClasses.length], large: false },
				{ id: String(photoIndex + 3), src: `/photos/exit_wounds/${imageFiles[photoIndex + 2]}`, alt: 'In Thorns - Exit Wounds', colorClass: colorClasses[(photoIndex + 2) % colorClasses.length], large: true }
			)
			photoIndex += 3
		}
	} else {
		// Group 4: 3 small
		for (let i = 0; i < 3 && photoIndex < imageFiles.length; i++) {
			photos.push({
				id: String(photoIndex + 1),
				src: `/photos/exit_wounds/${imageFiles[photoIndex]}`,
				alt: 'In Thorns - Exit Wounds',
				colorClass: colorClasses[photoIndex % colorClasses.length],
				large: false
			})
			photoIndex++
		}
	}

	groupType = (groupType + 1) % 4
}
---

<section id='photos' class='min-h-screen bg-black py-20 px-4'>
	<div class='container mx-auto max-w-7xl'>
		<h2 class='text-4xl md:text-5xl font-bold text-ew-orange mb-16 text-center'>
			<span class='inline-block' style='text-shadow: 0 0 20px rgba(255, 107, 53, 0.5);'>Photos</span>
		</h2>

		<div class='grid grid-cols-1 md:grid-cols-3 gap-4'>
			{
				photos.map((photo) => (
					<PhotoItem
						id={photo.id}
						src={photo.src}
						alt={photo.alt}
						colorClass={photo.colorClass}
						large={photo.large}
					/>
				))
			}
		</div>
	</div>
</section>
